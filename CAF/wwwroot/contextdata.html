<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Context Data - Cognitive Agent Framework</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="stylesheet" href="styles.css?v=2">
    <style>
        /* Table-based layout */
        .data-table {
            width: 100%;
            font-size: 13px;
        }
        .data-table thead {
            position: sticky;
            top: 0;
            z-index: 10;
            background: #f8f9fa;
        }
        .data-table th {
            font-weight: 600;
            font-size: 12px;
            padding: 10px 8px;
            border-bottom: 2px solid #dee2e6;
            white-space: nowrap;
        }
        .data-table td {
            padding: 8px;
            vertical-align: middle;
            border-bottom: 1px solid #e9ecef;
        }
        .data-table tbody tr:hover {
            background: #f8f9fa;
        }
        .data-table tbody tr.archived {
            opacity: 0.5;
            background: #f5f5f5;
        }
        .data-table tbody tr.selected {
            background: #e3f2fd;
        }
        
        /* Compact badges */
        .badge-type {
            font-size: 10px;
            padding: 2px 6px;
            border-radius: 3px;
            font-weight: 500;
            white-space: nowrap;
        }
        .badge-quote { background: #e3f2fd; color: #1976d2; }
        .badge-memory { background: #f3e5f5; color: #7b1fa2; }
        .badge-insight { background: #e8f5e9; color: #388e3c; }
        .badge-characterprofile { background: #fff3e0; color: #f57c00; }
        .badge-personavoicesample { background: #fce4ec; color: #c2185b; }
        .badge-generic { background: #e0f7fa; color: #0097a7; }
        
        .badge-availability {
            font-size: 10px;
            padding: 2px 6px;
            border-radius: 3px;
            font-weight: 500;
            white-space: nowrap;
        }
        .badge-alwayson { background: #c8e6c9; color: #2e7d32; }
        .badge-manual { background: #fff9c4; color: #f9a825; }
        .badge-semantic { background: #d1c4e9; color: #512da8; }
        .badge-trigger { background: #ffccbc; color: #e64a19; }
        .badge-archive { background: #cfd8dc; color: #546e7a; }
        
        /* Content preview cell */
        .content-cell {
            max-width: 400px;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
            cursor: pointer;
            color: #555;
        }
        .content-cell:hover {
            color: #2196f3;
            text-decoration: underline;
        }
        
        /* Tags in table */
        .tags-cell {
            max-width: 250px;
        }
        .tag-item {
            display: inline-block;
            background: #e3f2fd;
            color: #1976d2;
            padding: 1px 6px;
            border-radius: 8px;
            font-size: 10px;
            margin: 2px;
        }
        
        /* Path cell */
        .path-cell {
            max-width: 200px;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
            font-size: 11px;
            color: #666;
            font-family: 'Courier New', monospace;
        }
        
        /* Action buttons in table */
        .action-btns {
            white-space: nowrap;
        }
        .action-btns .btn {
            padding: 2px 6px;
            font-size: 11px;
            margin: 1px;
        }
        
        .filter-section {
            background: white;
            border-radius: 10px;
            padding: 1.5rem;
            margin-bottom: 1.5rem;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
        }
        
        .type-tabs {
            display: flex;
            gap: 8px;
            flex-wrap: wrap;
            margin-bottom: 1rem;
        }
        .type-tab {
            padding: 8px 16px;
            border: 2px solid #ddd;
            border-radius: 20px;
            background: white;
            cursor: pointer;
            transition: all 0.2s;
            font-size: 13px;
            font-weight: 500;
            color: #333;
        }

        .type-tab:hover {
            border-color: #2196f3;
            color: #2196f3;
        }
        .type-tab.active {
            background: #2196f3;
            border-color: #2196f3;
            color: white;
        }
        
        .import-section {
            background: white;
            border-radius: 10px;
            padding: 1.5rem;
            margin-bottom: 1.5rem;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
            display: none;
        }
        .import-section.active {
            display: block;
        }
        
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 1rem;
            margin-bottom: 1rem;
        }
        .stat-card {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 1rem;
            border-radius: 8px;
            text-align: center;
        }
        .stat-card.secondary {
            background: linear-gradient(135deg, #11998e 0%, #38ef7d 100%);
        }
        .stat-card.tertiary {
            background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
        }
        .stat-value {
            font-size: 1.5rem;
            font-weight: 700;
        }
        .stat-label {
            font-size: 0.85rem;
            opacity: 0.9;
        }
        
        
        .sort-controls {
            display: flex;
            gap: 8px;
            align-items: center;
        }
        
        .no-data {
            text-align: center;
            padding: 3rem;
            color: #666;
        }
        .no-data i {
            font-size: 3rem;
            margin-bottom: 1rem;
            opacity: 0.3;
        }
        
        .import-section .tab-content {
            padding-top: 1rem;
        }
        .import-section .tab-pane.active {
            display: block !important;
        }
        .import-section .nav-tabs .nav-link {
            color: #495057;
        }
        .import-section .nav-tabs .nav-link.active {
            color: #2196f3;
            border-color: #dee2e6 #dee2e6 #fff;
        }
        
        /* Selection styles */
        .data-card.selected {
            border: 2px solid #2196f3;
            background: #e3f2fd;
        }
        .data-checkbox {
            width: 18px;
            height: 18px;
            cursor: pointer;
        }
        .selection-toolbar {
            position: sticky;
            top: 0;
            z-index: 100;
        }
        
        /* Inline editing styles */
        .editable-cell {
            cursor: pointer;
            position: relative;
            transition: background-color 0.2s;
        }
        .editable-cell:hover {
            background-color: #fffde7 !important;
        }
        .editable-cell:hover::after {
            content: '?';
            position: absolute;
            right: 4px;
            top: 50%;
            transform: translateY(-50%);
            font-size: 10px;
            color: #999;
        }
        .inline-edit-input {
            width: 100%;
            min-width: 150px;
        }
        .editable-cell .inline-edit-input {
            margin: 0;
            padding: 4px;
        }
        
        /* Trigger cell styles */
        .trigger-cell {
            padding: 4px 8px;
        }
        .trigger-keywords {
            flex: 1;
            padding: 2px 4px;
            border-radius: 3px;
        }
        .trigger-keywords:hover {
            background-color: #fffde7;
        }
    </style>
</head>
<body>
    <div class="app-container">
        <div id="sidebar-container"></div>

        <main class="main-content">
            <div class="content-wrapper">
                <div class="page-header">
                    <h1><i class="fas fa-database"></i> Context Data Manager</h1>
                    <p class="page-subtitle">Unified management for quotes, memories, insights, profiles, and data</p>
                </div>

                <!-- Stats Section -->
                <div class="stats-grid" id="statsGrid">
                    <div class="stat-card">
                        <div class="stat-value" id="totalCount">0</div>
                        <div class="stat-label">Total Items</div>
                    </div>
                    <div class="stat-card secondary">
                        <div class="stat-value" id="activeCount">0</div>
                        <div class="stat-label">Active</div>
                    </div>
                    <div class="stat-card tertiary">
                        <div class="stat-value" id="embeddedCount">0</div>
                        <div class="stat-label">Embedded</div>
                    </div>
                </div>

                <!-- Type Tabs & Filters -->
                <div class="filter-section">
                    <div class="d-flex justify-content-between align-items-start mb-3">
                        <div class="type-tabs" id="typeTabs">
                            <button class="type-tab active" data-type="all">All Types</button>
                            <button class="type-tab" data-type="Quote">Quotes</button>
                            <button class="type-tab" data-type="Memory">Memories</button>
                            <button class="type-tab" data-type="Insight">Insights</button>
                            <button class="type-tab" data-type="CharacterProfile">Profiles</button>
                            <button class="type-tab" data-type="PersonaVoiceSample">Voice Samples</button>
                            <button class="type-tab" data-type="Generic">Generic Data</button>
                        </div>
                        <div class="d-flex gap-2">
                            <button class="btn btn-success btn-sm" onclick="window.contextDataActions.showCreateModal()">
                                <i class="fas fa-plus"></i> Add New
                            </button>
                            <button class="btn btn-info btn-sm" onclick="window.contextDataActions.toggleImportSection()">
                                <i class="fas fa-file-import"></i> Import
                            </button>
                        </div>
                    </div>
                    
                    <div class="row g-3">
                        <div class="col-md-2">
                            <label class="form-label small">Availability</label>
                            <select id="availabilityFilter" class="form-select form-select-sm">
                                <option value="">All</option>
                                <option value="AlwaysOn">Always On</option>
                                <option value="Manual">Manual</option>
                                <option value="Semantic">Semantic</option>
                                <option value="Trigger">Trigger</option>
                                <option value="Archive">Archived</option>
                            </select>
                        </div>
                        <div class="col-md-2">
                            <label class="form-label small">Embedded Status</label>
                            <select id="embeddedFilter" class="form-select form-select-sm">
                                <option value="">All</option>
                                <option value="embedded">Embedded</option>
                                <option value="not-embedded">Not Embedded</option>
                            </select>
                        </div>
                        <div class="col-md-2">
                            <label class="form-label small">Tag Status</label>
                            <select id="tagFilter" class="form-select form-select-sm">
                                <option value="">All</option>
                                <option value="tagged">Has Tags</option>
                                <option value="untagged">No Tags</option>
                            </select>
                        </div>
                        <div class="col-md-2">
                            <label class="form-label small">Speaker</label>
                            <select id="speakerFilter" class="form-select form-select-sm">
                                <option value="">All Speakers</option>
                            </select>
                        </div>
                        <div class="col-md-2">
                            <label class="form-label small">Session</label>
                            <select id="sessionFilter" class="form-select form-select-sm">
                                <option value="">All Sessions</option>
                            </select>
                        </div>
                        <div class="col-md-2">
                            <label class="form-label small">Search</label>
                            <input type="text" id="searchInput" class="form-control form-control-sm" placeholder="Search...">
                        </div>
                    </div>
                    
                    <div class="row g-3 mt-2">
                        <div class="col-md-3">
                            <label class="form-label small">Sort By</label>
                            <select id="sortBy" class="form-select form-select-sm">
                                <option value="name">Name</option>
                                <option value="type">Type</option>
                                <option value="availability">Availability</option>
                                <option value="createdAt">Created Date</option>
                                <option value="modifiedAt">Modified Date</option>
                                <option value="usageCount">Usage Count</option>
                            </select>
                        </div>
                        <div class="col-md-2">
                            <label class="form-label small">Order</label>
                            <select id="sortOrder" class="form-select form-select-sm">
                                <option value="asc">Ascending</option>
                                <option value="desc">Descending</option>
                            </select>
                        </div>
                        <div class="col-md-7 d-flex align-items-end">
                            <label class="form-check form-check-inline">
                                <input type="checkbox" class="form-check-input" id="includeArchived">
                                <span class="form-check-label small">Include Archived</span>
                            </label>
                        </div>
                    </div>
                </div>

                <!-- Import Section -->
                <div class="import-section" id="importSection">
                    <h4 class="mb-3"><i class="fas fa-file-import"></i> Import Data</h4>
                    
                    <ul class="nav nav-tabs mb-3" role="tablist">
                        <li class="nav-item" role="presentation">
                            <button class="nav-link active" id="tsv-quotes-tab" data-bs-toggle="tab" data-bs-target="#tsvQuotesImport" type="button" role="tab" aria-controls="tsvQuotesImport" aria-selected="true">TSV Import (Quotes)</button>
                        </li>
                        <li class="nav-item" role="presentation">
                            <button class="nav-link" id="tsv-voice-tab" data-bs-toggle="tab" data-bs-target="#tsvVoiceImport" type="button" role="tab" aria-controls="tsvVoiceImport" aria-selected="false">TSV Import (Voice Samples)</button>
                        </li>
                        <li class="nav-item" role="presentation">
                            <button class="nav-link" id="markdown-tab" data-bs-toggle="tab" data-bs-target="#markdownImport" type="button" role="tab" aria-controls="markdownImport" aria-selected="false">Markdown Import (Memories)</button>
                        </li>
                        <li class="nav-item" role="presentation">
                            <button class="nav-link" id="folder-tab" data-bs-toggle="tab" data-bs-target="#folderImport" type="button" role="tab" aria-controls="folderImport" aria-selected="false">Folder Import</button>
                        </li>
                    </ul>
                    
                    <div class="tab-content">
                        <!-- TSV Import (Quotes) -->
                        <div class="tab-pane fade show active" id="tsvQuotesImport" role="tabpanel" aria-labelledby="tsv-quotes-tab">
                            <p class="text-muted small">
                                Import quotes from TSV format.<br>
                                <strong>Full format (3 columns):</strong> Session, Speaker, Content<br>
                                <strong>Simple format (2 columns with Speaker field):</strong> Session, Content
                            </p>
                            <div class="row g-3">
                                <div class="col-md-12">
                                    <textarea id="tsvQuotesContent" class="form-control" rows="6" placeholder="Paste TSV content here..."></textarea>
                                </div>
                                <div class="col-md-4">
                                    <label class="form-label small">Default Availability</label>
                                    <select id="tsvQuotesAvailability" class="form-select form-select-sm">
                                        <option value="Semantic">Semantic</option>
                                        <option value="AlwaysOn">Always On</option>
                                        <option value="Manual">Manual</option>
                                        <option value="Archive">Archive</option>
                                    </select>
                                </div>
                                <div class="col-md-4">
                                    <label class="form-label small">Speaker (for 2-column format)</label>
                                    <input type="text" id="tsvQuotesSpeaker" class="form-control form-control-sm" placeholder="Leave empty for 3-column">
                                </div>
                                <div class="col-md-4 d-flex align-items-end">
                                    <div class="form-check me-3">
                                        <input type="checkbox" class="form-check-input" id="tsvQuotesHasHeader">
                                        <label class="form-check-label small">Has Header Row</label>
                                    </div>
                                    <button class="btn btn-primary btn-sm" onclick="window.contextDataActions.importQuotesTsv()">
                                        <i class="fas fa-upload"></i> Import
                                    </button>
                                </div>
                            </div>
                        </div>
                        
                        <!-- TSV Import (Voice Samples) -->
                        <div class="tab-pane fade" id="tsvVoiceImport" role="tabpanel" aria-labelledby="tsv-voice-tab">
                            <p class="text-muted small">
                                Import voice samples from TSV format.<br>
                                <strong>Format (2 columns):</strong> Dialogue, Nonverbal Behavior
                            </p>
                            <div class="row g-3">
                                <div class="col-md-12">
                                    <textarea id="tsvVoiceContent" class="form-control" rows="6" placeholder="Paste TSV content here...&#10;Example:&#10;I am hungry.&#09;She leans into him.&#10;Come closer.&#09;He gestures."></textarea>
                                </div>
                                <div class="col-md-4">
                                    <label class="form-label small">Default Availability</label>
                                    <select id="tsvVoiceAvailability" class="form-select form-select-sm">
                                        <option value="Semantic">Semantic</option>
                                        <option value="AlwaysOn">Always On</option>
                                        <option value="Manual">Manual</option>
                                        <option value="Archive">Archive</option>
                                    </select>
                                </div>
                                <div class="col-md-4">
                                    <label class="form-label small">Speaker</label>
                                    <input type="text" id="tsvVoiceSpeaker" class="form-control form-control-sm" placeholder="Username">
                                </div>
                                <div class="col-md-4 d-flex align-items-end">
                                    <div class="form-check me-3">
                                        <input type="checkbox" class="form-check-input" id="tsvVoiceHasHeader">
                                        <label class="form-check-label small">Has Header Row</label>
                                    </div>
                                    <button class="btn btn-primary btn-sm" onclick="window.contextDataActions.importVoiceTsv()">
                                        <i class="fas fa-upload"></i> Import
                                    </button>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Markdown Import -->
                        <div class="tab-pane fade" id="markdownImport" role="tabpanel" aria-labelledby="markdown-tab">
                            <p class="text-muted small">Import from Markdown. Each ## or ### heading becomes a separate item.</p>
                            <div class="row g-3">
                                <div class="col-md-12">
                                    <textarea id="markdownContent" class="form-control" rows="6" placeholder="Paste Markdown content here..."></textarea>
                                </div>
                                <div class="col-md-4">
                                    <label class="form-label small">Data Type</label>
                                    <select id="markdownDataType" class="form-select form-select-sm">
                                        <option value="Memory">Memory</option>
                                        <option value="Insight">Insight</option>
                                        <option value="Data">Generic Data</option>
                                    </select>
                                </div>
                                <div class="col-md-4">
                                    <label class="form-label small">Default Availability</label>
                                    <select id="markdownAvailability" class="form-select form-select-sm">
                                        <option value="Semantic">Semantic</option>
                                        <option value="AlwaysOn">Always On</option>
                                        <option value="Manual">Manual</option>
                                        <option value="Archive">Archive</option>
                                    </select>
                                </div>
                                <div class="col-md-4 d-flex align-items-end">
                                    <button class="btn btn-primary btn-sm" onclick="window.contextDataActions.importMarkdown()">
                                        <i class="fas fa-upload"></i> Import
                                    </button>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Folder Import -->
                        <div class="tab-pane fade" id="folderImport" role="tabpanel" aria-labelledby="folder-tab">
                            <p class="text-muted small">Import all files from a folder. Each file becomes a separate item, or updates existing items by matching filename to item name.</p>
                            <div class="row g-3">
                                <div class="col-md-6">
                                    <label class="form-label small">Folder Path</label>
                                    <input type="text" id="folderPath" class="form-control form-control-sm" placeholder="C:\path\to\folder">
                                </div>
                                <div class="col-md-6">
                                    <label class="form-label small">File Extensions (comma-separated)</label>
                                    <input type="text" id="folderExtensions" class="form-control form-control-sm" value=".md,.txt" placeholder=".md,.txt">
                                </div>
                                <div class="col-md-3">
                                    <label class="form-label small">Data Type</label>
                                    <select id="folderDataType" class="form-select form-select-sm">
                                        <option value="Data">Generic Data</option>
                                        <option value="Memory">Memory</option>
                                        <option value="Insight">Insight</option>
                                        <option value="CharacterProfile">Character Profile</option>
                                    </select>
                                </div>
                                <div class="col-md-3">
                                    <label class="form-label small">Default Availability</label>
                                    <select id="folderAvailability" class="form-select form-select-sm">
                                        <option value="AlwaysOn">Always On</option>
                                        <option value="Semantic">Semantic</option>
                                        <option value="Manual">Manual</option>
                                        <option value="Archive">Archive</option>
                                    </select>
                                </div>
                                <div class="col-md-3">
                                    <label class="form-label small">&nbsp;</label>
                                    <div class="form-check">
                                        <input type="checkbox" class="form-check-input" id="folderUpdateExisting" checked>
                                        <label class="form-check-label small" for="folderUpdateExisting">
                                            Update Existing Items
                                        </label>
                                    </div>
                                    <small class="text-muted">Matches filename to item name (e.g., bond.md â†’ "bond")</small>
                                </div>
                                <div class="col-md-3 d-flex align-items-end">
                                    <button class="btn btn-primary btn-sm" onclick="window.contextDataActions.importFolder()">
                                        <i class="fas fa-folder-open"></i> Import Folder
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Data List -->
                <div style="background: white; border-radius: 10px; padding: 1.5rem; box-shadow: 0 4px 6px rgba(0,0,0,0.1);">
                    <div class="d-flex justify-content-between align-items-center mb-3">
                        <div class="d-flex align-items-center gap-3">
                            <div class="form-check">
                                <input type="checkbox" class="form-check-input" id="selectAll" onchange="window.contextDataActions.toggleSelectAll(this.checked)">
                                <label class="form-check-label small" for="selectAll">Select All</label>
                            </div>
                            <h3 class="mb-0"><i class="fas fa-list"></i> Context Data <small class="text-muted" id="resultCount"></small></h3>
                        </div>
                        <div class="btn-group">
                            <button class="btn btn-outline-secondary btn-sm" onclick="window.contextDataActions.bulkGenerateTags()" title="Generate tags for all Semantic items without tags">
                                <i class="fas fa-tags"></i> Bulk Tags
                            </button>
                            <button class="btn btn-outline-secondary btn-sm" onclick="window.contextDataActions.bulkEmbed()" title="Embed all tagged Semantic items">
                                <i class="fas fa-vector-square"></i> Bulk Embed
                            </button>
                        </div>
                    </div>
                    
                    <!-- Selection Toolbar -->
                    <div id="selectionToolbar" class="selection-toolbar mb-3" style="display: none;">
                        <div class="d-flex align-items-center gap-3 p-2 bg-primary text-white rounded">
                            <span><strong id="selectedCount">0</strong> items selected</span>
                            <div class="btn-group">
                                <button class="btn btn-light btn-sm" onclick="window.contextDataActions.bulkChangeAvailability()">
                                    <i class="fas fa-toggle-on"></i> Change Availability
                                </button>
                                <button class="btn btn-light btn-sm" onclick="window.contextDataActions.bulkTagSelected()">
                                    <i class="fas fa-tags"></i> Generate Tags
                                </button>
                                <button class="btn btn-light btn-sm" onclick="window.contextDataActions.bulkEmbedSelected()">
                                    <i class="fas fa-vector-square"></i> Embed
                                </button>
                                <button class="btn btn-light btn-sm" onclick="window.contextDataActions.bulkUnembedSelected()">
                                    <i class="fas fa-times-circle"></i> Unembed
                                </button>
                                <button class="btn btn-light btn-sm" onclick="window.contextDataActions.bulkCountTokens()">
                                    <i class="fas fa-calculator"></i> Count Tokens
                                </button>
                                <button class="btn btn-warning btn-sm" onclick="window.contextDataActions.bulkArchiveSelected()">
                                    <i class="fas fa-archive"></i> Archive
                                </button>
                            </div>
                            <button class="btn btn-outline-light btn-sm ms-auto" onclick="window.contextDataActions.clearSelection()">
                                <i class="fas fa-times"></i> Clear
                            </button>
                        </div>
                    </div>
                    
                    <div id="dataList">
                        <p class="text-muted">Loading data...</p>
                    </div>
                </div>
            </div>
        </main>
    </div>

    <!-- Create/Edit Modal -->
    <div class="modal fade" id="editModal" tabindex="-1">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <div class="modal-header" style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white;">
                    <h5 class="modal-title" id="modalTitle">Add Context Data</h5>
                    <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <input type="hidden" id="editId">
                    
                    <div class="row g-3">
                        <div class="col-md-6">
                            <label class="form-label">Name *</label>
                            <input type="text" class="form-control" id="editName" required>
                        </div>
                        <div class="col-md-3">
                            <label class="form-label">Type *</label>
                            <select class="form-select" id="editType">
                                <option value="Quote">Quote</option>
                                <option value="Memory">Memory</option>
                                <option value="Insight">Insight</option>
                                <option value="CharacterProfile">Character Profile</option>
                                <option value="PersonaVoiceSample">Voice Sample</option>
                                <option value="Generic">Generic Data</option>
                            </select>
                        </div>
                        <div class="col-md-3">
                            <label class="form-label">Availability *</label>
                            <select class="form-select" id="editAvailability">
                                <option value="AlwaysOn">Always On</option>
                                <option value="Manual">Manual</option>
                                <option value="Semantic">Semantic</option>
                                <option value="Trigger">Trigger</option>
                                <option value="Archive">Archive</option>
                            </select>
                        </div>
                        
                        <div class="col-12">
                            <label class="form-label">Content *</label>
                            <textarea class="form-control" id="editContent" rows="6" required></textarea>
                        </div>
                        
                        <div class="col-12">
                            <label class="form-label">Summary (optional)</label>
                            <textarea class="form-control" id="editSummary" rows="2"></textarea>
                        </div>
                        
                        <!-- Trigger Fields -->
                        <div class="col-12 trigger-fields" style="display: none;">
                            <div class="card">
                                <div class="card-header bg-warning text-dark">
                                    <i class="fas fa-bolt"></i> Trigger Settings
                                </div>
                                <div class="card-body">
                                    <div class="row g-2">
                                        <div class="col-md-12">
                                            <label class="form-label small">Trigger Keywords (comma-separated)</label>
                                            <input type="text" class="form-control form-control-sm" id="editTriggerKeywords" placeholder="keyword1, keyword2, phrase three">
                                        </div>
                                        <div class="col-md-6">
                                            <label class="form-label small">Lookback Turns</label>
                                            <input type="number" class="form-control form-control-sm" id="editTriggerLookback" value="3" min="1" max="20">
                                        </div>
                                        <div class="col-md-6">
                                            <label class="form-label small">Min Match Count</label>
                                            <input type="number" class="form-control form-control-sm" id="editTriggerMinMatch" value="1" min="1" max="10">
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Manual Fields -->
                        <div class="col-12 manual-fields" style="display: none;">
                            <div class="card">
                                <div class="card-header bg-info text-white">
                                    <i class="fas fa-hand-pointer"></i> Manual Settings
                                </div>
                                <div class="card-body">
                                    <div class="form-check">
                                        <input type="checkbox" class="form-check-input" id="editUseNextTurnOnly">
                                        <label class="form-check-label">Use Next Turn Only</label>
                                        <small class="text-muted d-block">Automatically revert after being used once</small>
                                    </div>
                                    <div class="form-check mt-2">
                                        <input type="checkbox" class="form-check-input" id="editUseEveryTurn">
                                        <label class="form-check-label">Use Every Turn</label>
                                        <small class="text-muted d-block">Include in every turn until toggled off</small>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Optional Fields -->
                        <div class="col-md-6">
                            <label class="form-label">Speaker (optional)</label>
                            <input type="text" class="form-control" id="editSpeaker">
                        </div>
                        <div class="col-md-6">
                            <label class="form-label">Subtype (optional)</label>
                            <input type="text" class="form-control" id="editSubtype" placeholder="dialogue, narration, internal...">
                        </div>
                        
                        <div class="col-md-12">
                            <label class="form-label">Path (optional)</label>
                            <input type="text" class="form-control" id="editPath" placeholder="Path to file on disk">
                            <small class="text-muted">File path for content reloading</small>
                        </div>
                        
                        <div class="col-md-6">
                            <label class="form-label">Tags (comma-separated)</label>
                            <input type="text" class="form-control" id="editTags" placeholder="tag1, tag2, tag3">
                        </div>
                        <div class="col-md-3">
                            <label class="form-label">Sort Order</label>
                            <input type="number" class="form-control" id="editSortOrder" value="0">
                        </div>
                        
                        <div class="col-12">
                            <label class="form-label">Description/Notes</label>
                            <textarea class="form-control" id="editDescription" rows="2"></textarea>
                        </div>
                        
                        <div class="col-md-6">
                            <div class="form-check">
                                <input type="checkbox" class="form-check-input" id="editIsEnabled" checked>
                                <label class="form-check-label">Enabled</label>
                            </div>
                        </div>
                        <div class="col-md-6">
                            <div class="form-check">
                                <input type="checkbox" class="form-check-input" id="editIsUser">
                                <label class="form-check-label">Is User Profile (CharacterProfile only)</label>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                    <button type="button" class="btn btn-primary" onclick="window.contextDataActions.saveItem()">Save</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Availability Change Confirmation Modal -->
    <div class="modal fade" id="confirmAvailabilityModal" tabindex="-1">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header bg-warning">
                    <h5 class="modal-title"><i class="fas fa-exclamation-triangle"></i> Confirm Availability Change</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <p id="availabilityWarningText"></p>
                    <p class="text-danger"><strong>This item will be removed from the vector database.</strong></p>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                    <button type="button" class="btn btn-warning" id="confirmAvailabilityBtn">Confirm Change</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Bulk Availability Change Modal -->
    <div class="modal fade" id="bulkAvailabilityModal" tabindex="-1">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header" style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white;">
                    <h5 class="modal-title"><i class="fas fa-toggle-on"></i> Bulk Change Availability</h5>
                    <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <p>Change availability for <strong id="bulkAvailabilityCount">0</strong> selected items:</p>
                    <div class="mb-3">
                        <label class="form-label">New Availability</label>
                        <select id="bulkAvailabilitySelect" class="form-select">
                            <option value="AlwaysOn">Always On</option>
                            <option value="Manual">Manual</option>
                            <option value="Semantic">Semantic</option>
                            <option value="Trigger">Trigger</option>
                            <option value="Archive">Archive</option>
                        </select>
                    </div>
                    <div class="alert alert-warning small">
                        <i class="fas fa-info-circle"></i> Items with availability changed from Semantic will be removed from the vector database.
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                    <button type="button" class="btn btn-primary" onclick="window.contextDataActions.confirmBulkAvailability()">Apply</button>
                </div>
            </div>
        </div>
    </div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.7.1/jquery.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script src="js/sidebar-loader.js"></script>
    <script type="module" src="contextdata.js"></script>
</body>
</html>
